<!DOCTYPE html>
<html>
<head>
    <title>UI Fix Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="static/style.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>UI Fix Test</h1>
        <div class="alert alert-info">
            Test: Add items, then remove them. Check if they disappear properly from both list and results.
        </div>
        
        <!-- Item Input -->
        <div class="mb-3">
            <input type="text" id="newItem" class="form-control" placeholder="Enter grocery item (e.g., milk 2L, bread, apples)">
            <button class="btn btn-primary mt-2" id="addItemBtn">Add Item</button>
        </div>
        
        <!-- Shopping List Items -->
        <div class="mb-3">
            <label class="form-label">Items to Check:</label>
            <div id="shoppingList" class="border rounded p-2 min-height-100">
                <div class="text-muted text-center" id="emptyState">
                    <i class="bi bi-cart-x fs-1"></i>
                    <p>No items yet. Add some items to get started!</p>
                </div>
            </div>
        </div>
        
        <!-- Buttons -->
        <button class="btn btn-success" id="checkPricesBtn" disabled>Check Prices</button>
        <button class="btn btn-outline-secondary" id="clearListBtn">Clear List</button>
        
        <!-- Results Section -->
        <div id="resultsSummary" class="alert alert-success d-none mt-4">
            <h5>Results Summary</h5>
            <div id="summaryContent"></div>
        </div>
        
        <div id="resultsContainer" class="row mt-4 d-none">
            <div class="col-12">
                <h4>Price Check Results</h4>
                <div id="resultsContent"></div>
            </div>
        </div>
        
        <div id="resultsEmptyState" class="text-center text-muted mt-4">
            <i class="bi bi-search fs-1"></i>
            <p>No results to show. Check some items to get started!</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Simplified app class for testing
        class TestApp {
            constructor() {
                this.items = [];
                this.results = null;
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                document.getElementById('addItemBtn').addEventListener('click', () => {
                    this.addItem();
                });

                document.getElementById('newItem').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.addItem();
                    }
                });

                document.getElementById('checkPricesBtn').addEventListener('click', () => {
                    this.simulateResults();
                });

                document.getElementById('clearListBtn').addEventListener('click', () => {
                    this.clearList();
                });
            }

            addItem() {
                const input = document.getElementById('newItem');
                const itemText = input.value.trim();
                
                if (itemText && !this.items.includes(itemText)) {
                    this.items.push(itemText);
                    this.updateShoppingListDisplay();
                    this.updateCheckButton();
                    input.value = '';
                    console.log('Added:', itemText);
                }
            }

            removeItem(itemText) {
                console.log('Removing item:', itemText);
                console.log('Items before:', this.items);
                this.items = this.items.filter(item => item !== itemText);
                console.log('Items after:', this.items);
                this.updateShoppingListDisplay();
                this.updateCheckButton();
                
                // Clear results since the item list has changed
                this.results = null;
                this.hideResults();
                
                console.log('Item removed successfully');
            }

            updateShoppingListDisplay() {
                const container = document.getElementById('shoppingList');
                
                if (this.items.length === 0) {
                    container.innerHTML = `
                        <div class="text-muted text-center" id="emptyState">
                            <i class="bi bi-cart-x fs-1"></i>
                            <p>No items yet. Add some items to get started!</p>
                        </div>
                    `;
                    return;
                }

                const itemsHtml = this.items.map((item, index) => `
                    <div class="shopping-item new-item border rounded p-2 mb-2 d-flex justify-content-between align-items-center">
                        <span class="item-text">${this.escapeHtml(item)}</span>
                        <button class="remove-btn btn btn-outline-danger btn-sm" data-item-index="${index}" title="Remove item">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                `).join('');

                container.innerHTML = itemsHtml;

                // Add event listeners for remove buttons
                container.querySelectorAll('.remove-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.getAttribute('data-item-index'));
                        const itemText = this.items[index];
                        this.removeItem(itemText);
                    });
                });
            }

            updateCheckButton() {
                const btn = document.getElementById('checkPricesBtn');
                btn.disabled = this.items.length === 0;
            }

            clearList() {
                this.items = [];
                this.results = null;
                this.updateShoppingListDisplay();
                this.updateCheckButton();
                this.hideResults();
            }

            simulateResults() {
                // Simulate search results for testing
                document.getElementById('resultsSummary').classList.remove('d-none');
                document.getElementById('resultsContainer').classList.remove('d-none');
                document.getElementById('resultsEmptyState').classList.add('d-none');
                
                document.getElementById('summaryContent').innerHTML = `
                    <p>Found results for ${this.items.length} items: ${this.items.join(', ')}</p>
                `;
                
                document.getElementById('resultsContent').innerHTML = `
                    <p>Mock results for items: ${this.items.join(', ')}</p>
                `;
            }

            hideResults() {
                document.getElementById('resultsSummary').classList.add('d-none');
                document.getElementById('resultsContainer').classList.add('d-none');
                document.getElementById('resultsEmptyState').classList.remove('d-none');
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Initialize the test app
        const app = new TestApp();
    </script>
</body>
</html>